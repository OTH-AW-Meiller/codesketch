<script defer>

// Based on the idea of https://github.com/tomhodgins/liveeditor.
function init(isEditor) {
    const doc = document.getElementById('_parent');
    const ta_html = document.getElementById('crui_html');
    const ta_css = document.getElementById('crui_css');
    const ta_js = document.getElementById('crui_js');
    const clear = document.getElementById('ui_clearall');
    const iframe = document.getElementById("preview");
    if (!isEditor) {
        const html_editor = ace.edit("ui_html");
        html_editor.setTheme("ace/theme/textmate");
        html_editor.session.setMode("ace/mode/html");
        const css_editor = ace.edit("ui_css");
        css_editor.setTheme("ace/theme/textmate");
        css_editor.session.setMode("ace/mode/css");
        const js_editor = ace.edit("ui_js");
        js_editor.setTheme("ace/theme/textmate");
        js_editor.session.setMode("ace/mode/javascript");   
        html_editor.session.on("change", () => { ta_html.value = html_editor.getValue();});
        css_editor.session.on("change", () => { ta_css.value = css_editor.getValue();});
        js_editor.session.on("change", () => { ta_js.value = js_editor.getValue();});

        function show_preview() {
            iframedoc.open();
            iframe.contentWindow.onerror = function(message, source, lineno, colno, error) {
                return true;
            };
            iframedoc.write("<head><style>" + css_editor.getValue() + "</style></head><body>" + html_editor.getValue() + "<script>" + js_editor.getValue() + "<\/script></body>");
            iframedoc.close();
        }

        function clearAll() {
            html_editor.setValue(ta_html.value, -1);
            css_editor.setValue(ta_css.value, -1);
            js_editor.setValue(ta_js.value, -1);
        }

    }

    const iframedoc = iframe.contentWindow.document;
    doc.style.backgroundColor = "white";
    doc.style.padding = "10px";

    if(!isEditor) {
        document.querySelectorAll(".edit").forEach(el => el.hidden = true );
            doc.addEventListener('keyup', show_preview);
        clear.addEventListener('click', function(event) {
            event.preventDefault();
            clearAll();
        });
        clearAll();
        show_preview();
    } else {
        document.querySelectorAll(".live").forEach(el => el.hidden = true );
    }
}
init(window.location.href.includes("editquestion"));
</script>

 <style>
 iframe#preview {
   background: #fff;
   border: 3px solid #000;
   width: 100%;
   height: 200px;
   border-radius: 6px; 
 }
  ._ed {
   border: 2px solid #ccc;
   border-radius: 6px; 
 }
 .labl {
    margin-top: 10px;;
 }
textarea.coderunner-ui-element {
   background: #fff;
   color: #000;
   width: 100%;
   border-radius: 6px; 
 }
 </style>

<div id="_parent">
<div class="edit">
    <textarea id="crui_html" rows="10" value="" class="coderunner-ui-element" name='crui_html' spellcheck="false" placeholder="HTML" autocapitalize="off" autofocus
    style="font-family: monospace"></textarea>
    <br>
    <textarea id="crui_css" rows="10" value="" placeholder="CSS" class="coderunner-ui-element" name='crui_css' spellcheck="false" autocapitalize="off"
    style="font-family: monospace; margin-top:10px"></textarea>
    <br>
    <textarea id="crui_js" rows="10" value="" class="coderunner-ui-element" name='crui_js' spellcheck="false" placeholder="JavaScript" autocapitalize="off" style="font-family: monospace; margin-top:10px"></textarea>    
</div>
<div id="_eds"  class="live">
    <a id="ui_clearall" hidden class="labl" href="#" title="Click to clear all">Clear All</a>
    <div class="labl">HTML</div>
    <div id="ui_html" class="_ed" style="height: 150px; width: 100%;"></div>
    <div class="labl">CSS</div>
    <div id="ui_css"  class="_ed" style="height: 150px; width: 100%;"></div>
    <div class="labl">JS</div>
    <div id="ui_js"  class="_ed" style="height: 150px; width: 100%;"></div>
    <div class="labl">Preview</div>
    <iframe id="preview"></iframe>
</div>
</div>
